require "../spec_helper"

Spectator.describe Proton::Crypto::RSA do
  describe ".encrypt_hashed" do
    it "encrypts a value" do
      expected = Bytes[
        117, 112, 45, 76, 136, 210, 155, 106, 185, 52, 53, 81, 36, 221, 40, 217, 182, 42,
        71, 85, 136, 65, 200, 3, 20, 80, 247, 73, 155, 28, 156, 107, 211, 157, 39, 193, 88,
        28, 81, 52, 78, 81, 193, 121, 35, 112, 100, 167, 35, 174, 147, 157, 90, 195, 80,
        20, 253, 139, 79, 226, 79, 117, 227, 17, 92, 50, 161, 99, 105, 238, 43, 55, 58, 97,
        236, 148, 70, 185, 43, 46, 61, 240, 118, 24, 219, 10, 138, 253, 169, 153, 182, 112,
        43, 50, 181, 129, 155, 214, 234, 73, 112, 251, 52, 124, 168, 74, 96, 208, 195, 138,
        183, 12, 102, 229, 237, 1, 64, 68, 136, 137, 163, 184, 130, 238, 165, 51, 186, 208,
        94, 250, 32, 69, 237, 167, 23, 18, 60, 65, 74, 191, 222, 212, 62, 30, 180, 131,
        160, 73, 120, 110, 245, 3, 27, 18, 213, 26, 63, 247, 236, 183, 216, 4, 212, 65, 53,
        148, 95, 152, 247, 90, 74, 108, 241, 161, 223, 55, 85, 158, 48, 187, 233, 42, 75,
        121, 102, 195, 79, 7, 56, 230, 209, 48, 89, 133, 119, 109, 38, 223, 171, 124, 15,
        223, 215, 236, 32, 44, 199, 140, 84, 207, 130, 172, 35, 134, 199, 157, 14, 25, 117,
        128, 164, 250, 148, 48, 10, 35, 130, 249, 225, 22, 254, 130, 223, 155, 216, 114,
        229, 185, 218, 123, 66, 98, 35, 191, 26, 216, 88, 137, 48, 181, 30, 22, 93, 108,
        221, 2,
      ]

      key = Proton::Crypto::RSA::Key.new(
        BigInt.new("220819465310378335405242605806607740322074765211971211287403587614863647634670878287" +
                   "668739723380190789768549865310764847727717353997014245661770399268553567194977364392" +
                   "894552862772021139005095542660573024665289852536483183141292468252196401973561656267" +
                   "742769306726889732787126148000660375315993750447507535801264156130863726043123200143" +
                   "589943941316670228617675398792321494615799223164895326821657467625696517637945009236" +
                   "436567532788878719556762535266616944593700478432866858596887564292931841482023793568" +
                   "024888058627460460719218309218402730621245710733363692107034009858514314912959101871" +
                   "79045081526826572515473914151"),
        BigInt.new("65537"))
      result = described_class.encrypt_hashed("Hello!".to_slice, key, Bytes.new(256) { 0_u8 })

      expect(result).to eq(expected)
    end
  end
end
